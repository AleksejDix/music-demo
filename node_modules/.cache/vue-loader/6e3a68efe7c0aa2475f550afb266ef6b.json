{"remainingRequest":"/Users/aleksej/Projects/what2vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/aleksej/Projects/what2vue/src/views/Discover/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/aleksej/Projects/what2vue/src/views/Discover/index.vue","mtime":1615051630927},{"path":"/Users/aleksej/Projects/what2vue/node_modules/cache-loader/dist/cjs.js","mtime":1610645746854},{"path":"/Users/aleksej/Projects/what2vue/node_modules/babel-loader/lib/index.js","mtime":1610645748948},{"path":"/Users/aleksej/Projects/what2vue/node_modules/cache-loader/dist/cjs.js","mtime":1610645746854},{"path":"/Users/aleksej/Projects/what2vue/node_modules/vue-loader/lib/index.js","mtime":1610645763935}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBhcGkgZnJvbSAnQC9hcGknCmltcG9ydCBNb3ZpZUxpc3QgZnJvbSAnQC9jb21wb25lbnRzL01vdmllTGlzdCcKaW1wb3J0IEludGVyc2VjdGlvbk9ic2VydmVyIGZyb20gJ0AvY29tcG9uZW50cy9JbnRlcnNlY3Rpb25PYnNlcnZlcicKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7IE1vdmllTGlzdCwgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdG90YWw6IDAsCiAgICAgIG1vdmllczogW10sCiAgICAgIHBhZ2U6ICt0aGlzLiRyb3V0ZS5xdWVyeS5wYWdlIHx8IDEsCiAgICAgIHNvcnRfYnk6IHRoaXMuJHJvdXRlLnF1ZXJ5LnNvcnRfYnkgfHwgJ3BvcHVsYXJpdHknLAogICAgICBzb3J0X29yZGVyOiB0aGlzLiRyb3V0ZS5xdWVyeS5zb3J0X29yZGVyIHx8ICdkZXNjJywKICAgICAgd2l0aF9nZW5yZXM6ICcnLAogICAgICBnZW5yZXNfb3B0aW9uczogW10sCiAgICAgIHNvcnRfb3B0aW9uczogWwogICAgICAgIHsgdmFsdWU6ICdwb3B1bGFyaXR5JywgbmFtZTogJ1BvcHVsYXJpdHknIH0sCiAgICAgICAgeyB2YWx1ZTogJ3JldmVudWUnLCBuYW1lOiAnUmV2ZW51ZScgfSwKICAgICAgICB7IHZhbHVlOiAndm90ZV9jb3VudCcsIG5hbWU6ICdSYXRpbmcnIH0sCiAgICAgIF0sCiAgICAgIHNvcnRfb3JkZXJfb3B0aW9uczogWwogICAgICAgIHsgdmFsdWU6ICdhc2MnLCBuYW1lOiAnbG93IHRvIGhpZ2gnIH0sCiAgICAgICAgeyB2YWx1ZTogJ2Rlc2MnLCBuYW1lOiAnaGlnaHQgdG8gbG93JyB9LAogICAgICBdLAogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGhhc01vdmllcygpIHsKICAgICAgcmV0dXJuIHRoaXMubW92aWVzLmxlbmd0aCA+IDAKICAgIH0sCiAgICBxdWVyeSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBwYWdlOiB0aGlzLnBhZ2UsCiAgICAgICAgd2l0aF9nZW5yZXM6IHRoaXMud2l0aF9nZW5yZXMgfHwgJycsCiAgICAgICAgc29ydF9ieTogdGhpcy5zb3J0X2J5LAogICAgICAgIHNvcnRfb3JkZXI6IHRoaXMuc29ydF9vcmRlciwKICAgICAgfQogICAgfSwKICB9LAogIHdhdGNoOiB7CiAgICAncXVlcnkucGFnZScobmV4dCwgcHJldikgewogICAgICBpZiAobmV4dCA+IHByZXYpIHsKICAgICAgICB0aGlzLmxvYWRNb3JlKG5leHQpCiAgICAgIH0KICAgIH0sCiAgICBhc3luYyAncXVlcnkuc29ydF9vcmRlcicobmV4dCwgcHJldikgewogICAgICBpZiAobmV4dCAhPT0gcHJldikgewogICAgICAgIHRoaXMucmVzZXQoKQogICAgICB9CiAgICB9LAogICAgYXN5bmMgJ3F1ZXJ5LnNvcnRfYnknKG5leHQsIHByZXYpIHsKICAgICAgaWYgKG5leHQgIT09IHByZXYpIHsKICAgICAgICB0aGlzLnJlc2V0KG5leHQpCiAgICAgIH0KICAgIH0sCiAgICBhc3luYyAncXVlcnkud2l0aF9nZW5yZXMnKG5leHQsIHByZXYpIHsKICAgICAgaWYgKG5leHQgIT09IHByZXYpIHsKICAgICAgICB0aGlzLnJlc2V0KG5leHQpCiAgICAgIH0KICAgIH0sCiAgICAnJHJvdXRlLnF1ZXJ5JyhuZXh0LCBwcmV2KSB7CiAgICAgIGlmIChuZXh0ICE9PSBwcmV2KSB7CiAgICAgICAgdGhpcy5wYWdlID0gbmV4dC5wYWdlCiAgICAgICAgdGhpcy53aXRoX2dlbnJlcyA9IG5leHQud2l0aF9nZW5yZXMKICAgICAgICB0aGlzLnNvcnRfYnkgPSBuZXh0LnNvcnRfYnkKICAgICAgICB0aGlzLnNvcnRfb3JkZXIgPSBuZXh0LnNvcnRfb3JkZXIKICAgICAgfQogICAgfSwKICB9LAogIGFzeW5jIG1vdW50ZWQoKSB7CiAgICB0aGlzLmdlbnJlc19vcHRpb25zID0gYXdhaXQgdGhpcy5nZXRHZW5yZXMoKQogICAgdGhpcy5tb3ZpZXMgPSBhd2FpdCB0aGlzLmRpc2NvdmVyKCkKICB9LAogIGRlc3Ryb3llZCgpIHsKICAgIHRoaXMubW92aWVzID0gW10KICB9LAogIG1ldGhvZHM6IHsKICAgIGFzeW5jIGdldEdlbnJlcygpIHsKICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhcGkuZ2VucmUuaW5kZXgoKQogICAgICByZXR1cm4gcmVzcG9uc2UuZ2VucmVzCiAgICB9LAogICAgYXN5bmMgZGlzY292ZXIoKSB7CiAgICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5xdWVyeQogICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGFwaS5tb3ZpZURpc2NvdmVyLmluZGV4KHsgcXVlcnkgfSkKICAgICAgY29uc3QgeyB0b3RhbF9yZXN1bHRzLCByZXN1bHRzIH0gPSByZXNwb25zZQogICAgICB0aGlzLnRvdGFsID0gdG90YWxfcmVzdWx0cwogICAgICByZXR1cm4gcmVzdWx0cwogICAgfSwKICAgIG5leHRQYWdlKCkgewogICAgICB0aGlzLnBhZ2UrKwogICAgICB0aGlzLnVwZGF0ZVF1ZXJ5KHRoaXMucXVlcnkpCiAgICB9LAogICAgYXN5bmMgbG9hZE1vcmUoKSB7CiAgICAgIHRoaXMubW92aWVzID0gdGhpcy5tb3ZpZXMuY29uY2F0KGF3YWl0IHRoaXMuZGlzY292ZXIoKSkKICAgIH0sCiAgICBhc3luYyByZXNldCgpIHsKICAgICAgdGhpcy5wYWdlID0gMQogICAgICB0aGlzLm1vdmllcyA9IFtdCiAgICAgIHRoaXMudXBkYXRlUXVlcnkodGhpcy5xdWVyeSkKICAgICAgdGhpcy5tb3ZpZXMgPSBhd2FpdCB0aGlzLmRpc2NvdmVyKCkKICAgIH0sCiAgICBzdWJtaXQoKSB7CiAgICAgIHRoaXMudXBkYXRlUXVlcnkodGhpcy5xdWVyeSkKICAgIH0sCiAgICB1cGRhdGVRdWVyeShxdWVyeSkgewogICAgICBjb25zdCBwYXRoID0gdGhpcy4kcm91dGUubmFtZQogICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7IHBhdGgsIHF1ZXJ5IH0pCiAgICB9LAogIH0sCn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2EA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/Discover","sourcesContent":["<template>\n  <section class=\"max-w-7xl mx-auto sm:px-6 lg:px-8 grid gap-2\">\n    <header class=\"flex justify-between\">\n      <header class=\"flex justify-between\">\n        <h2 class=\"uppercase font-bold\">{{ $route.name }} â€¢ {{ total }}</h2>\n      </header>\n    </header>\n    <div class=\"filter\">\n      <form class=\"flex gap-2\" @submit.prevent=\"submit\">\n        <label v-if=\"genres_options.length > 0\" class=\"block\">\n          <span class=\"text-gray-700\">Genre</span>\n          <select\n            v-model=\"with_genres\"\n            name=\"with_genres\"\n            class=\"form-select block w-full mt-1\"\n          >\n            <option disabled value=\"\">select genre</option>\n            <option\n              v-for=\"option in genres_options\"\n              :key=\"option.id\"\n              :value=\"option.id\"\n            >\n              {{ option.name }}\n            </option>\n          </select>\n        </label>\n\n        <label class=\"block\">\n          <span class=\"text-gray-700\">Sort by</span>\n          <select\n            v-model=\"sort_by\"\n            name=\"sort_by\"\n            class=\"form-select block w-full mt-1\"\n          >\n            <option\n              v-for=\"option in sort_options\"\n              :key=\"option.value\"\n              :value=\"option.value\"\n            >\n              {{ option.name }}\n            </option>\n          </select>\n        </label>\n\n        <label class=\"block\">\n          <span class=\"text-gray-700\">Order</span>\n          <select\n            v-model=\"sort_order\"\n            name=\"sort_by\"\n            class=\"form-select block w-full mt-1\"\n          >\n            <option\n              v-for=\"option in sort_order_options\"\n              :key=\"option.value\"\n              :value=\"option.value\"\n            >\n              {{ option.name }}\n            </option>\n          </select>\n        </label>\n\n        <button class=\"hidden\">send</button>\n      </form>\n    </div>\n    <div v-if=\"hasMovies\">\n      <MovieList :list=\"movies\" />\n      <IntersectionObserver\n        :options=\"{ rootMargin: '300px' }\"\n        @intersect=\"nextPage\"\n      />\n    </div>\n  </section>\n</template>\n\n<script>\nimport api from '@/api'\nimport MovieList from '@/components/MovieList'\nimport IntersectionObserver from '@/components/IntersectionObserver'\n\nexport default {\n  components: { MovieList, IntersectionObserver },\n  data() {\n    return {\n      total: 0,\n      movies: [],\n      page: +this.$route.query.page || 1,\n      sort_by: this.$route.query.sort_by || 'popularity',\n      sort_order: this.$route.query.sort_order || 'desc',\n      with_genres: '',\n      genres_options: [],\n      sort_options: [\n        { value: 'popularity', name: 'Popularity' },\n        { value: 'revenue', name: 'Revenue' },\n        { value: 'vote_count', name: 'Rating' },\n      ],\n      sort_order_options: [\n        { value: 'asc', name: 'low to high' },\n        { value: 'desc', name: 'hight to low' },\n      ],\n    }\n  },\n  computed: {\n    hasMovies() {\n      return this.movies.length > 0\n    },\n    query() {\n      return {\n        page: this.page,\n        with_genres: this.with_genres || '',\n        sort_by: this.sort_by,\n        sort_order: this.sort_order,\n      }\n    },\n  },\n  watch: {\n    'query.page'(next, prev) {\n      if (next > prev) {\n        this.loadMore(next)\n      }\n    },\n    async 'query.sort_order'(next, prev) {\n      if (next !== prev) {\n        this.reset()\n      }\n    },\n    async 'query.sort_by'(next, prev) {\n      if (next !== prev) {\n        this.reset(next)\n      }\n    },\n    async 'query.with_genres'(next, prev) {\n      if (next !== prev) {\n        this.reset(next)\n      }\n    },\n    '$route.query'(next, prev) {\n      if (next !== prev) {\n        this.page = next.page\n        this.with_genres = next.with_genres\n        this.sort_by = next.sort_by\n        this.sort_order = next.sort_order\n      }\n    },\n  },\n  async mounted() {\n    this.genres_options = await this.getGenres()\n    this.movies = await this.discover()\n  },\n  destroyed() {\n    this.movies = []\n  },\n  methods: {\n    async getGenres() {\n      const response = await api.genre.index()\n      return response.genres\n    },\n    async discover() {\n      const query = this.query\n      const response = await api.movieDiscover.index({ query })\n      const { total_results, results } = response\n      this.total = total_results\n      return results\n    },\n    nextPage() {\n      this.page++\n      this.updateQuery(this.query)\n    },\n    async loadMore() {\n      this.movies = this.movies.concat(await this.discover())\n    },\n    async reset() {\n      this.page = 1\n      this.movies = []\n      this.updateQuery(this.query)\n      this.movies = await this.discover()\n    },\n    submit() {\n      this.updateQuery(this.query)\n    },\n    updateQuery(query) {\n      const path = this.$route.name\n      this.$router.push({ path, query })\n    },\n  },\n}\n</script>\n\n<style>\n.filter {\n  padding: 1rem 0;\n}\n</style>\n"]}]}